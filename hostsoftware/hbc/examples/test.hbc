include another_file.hbc;

endpoint 0 {
  access { read };
  datatype UINT32;
  name device_descriptor;
}

endpoint 1 {
  access { read, write };
  datatype BOOL;
  name on;
}

endpoint 2 {
  name power;
  datatype UINT32; access { read, broadcast };
}

alias device {
  ip fe80::cafe:d00d;
  eids { 1, 2, 3 };
}

alias another_device {
  ip ::;
  eids { 9 };
}

machine my_machine {
  states { one, two, three };
  in(one) {
    if(device.endpoint == 23) {
      write device.other_endpoint := 42;
      goto two;
    }
  }
  in(two) {
    if(device.endpoint == 23) {
      goto three;
    }
    if(device.endpoint == 25) {
      write blah.blaah := 0;
      goto three;
    }
    else {
      write foo.bar := 1;
      goto one;
    }
  }
}

machine another_machine {
  states { bloerp };
  in(bloerp) {
    if(device.endpoint == 104.2345) { goto init; }
  }
}

# example machine from the "example.hbc" - minus everything we can't parse yet
machine main {
  states { init };
  in(init)
  {
    if((sensorbox.temperature < 19) && ((sensorbox.temperature != 7) || (device.endpoint == 98765))) {
      write heater.heater := 100;
      goto init;
    } else if(sensorbox.temperature >= 19) {
      write heater.heater := 50;
      goto init;
    } else {
      write heater.heater := 0;
      goto init;
    }
  }
}

module toggle($DEVICE, $ENDPOINT, $VALUE, $TARGETDEV, $TARGETEP) {
  states { power_on, power_off };
# init {
#   $TARGET := true;
#   goto power_on;
# }
  in(power_on) {
    if($DEVICE.$ENDPOINT == $VALUE) {
      write $TARGETDEV.$TARGETEP := 0;
      goto power_off;
    }
  }
  in(power_off) {
    if($DEVICE.$ENDPOINT == $VALUE) {
      write $TARGETDEV.$TARGETEP := 1;
      goto power_on;
    }
  }
}
